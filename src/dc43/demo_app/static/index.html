<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>DC43 Demo</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-light bg-light mb-4">
  <div class="container-fluid">
    <a class="navbar-brand" href="/">DC43 Demo</a>
    <div class="navbar-nav">
      <a class="nav-link" href="/contracts">Contracts</a>
      <a class="nav-link" href="/datasets">Datasets</a>
    </div>
  </div>
</nav>
<div id="app" class="container py-4">
  <h1 class="mb-4">DC43 Demo</h1>
  <div class="mb-3">
    <button class="btn btn-primary me-2" @click="view='datasets'">Datasets</button>
    <button class="btn btn-secondary me-2" @click="view='contracts'">Contracts</button>
    <a class="btn btn-outline-primary me-2" href="/datasets">Pipeline Form</a>
    <a class="btn btn-outline-secondary" href="/contracts">Contracts UI</a>
  </div>

  <div v-if="view==='datasets'">
    <h2>Datasets</h2>
    <table class="table">
      <thead><tr><th>Dataset Version</th><th>Contract</th><th>Status</th><th></th></tr></thead>
      <tbody>
        <tr v-for="ds in datasets" :key="ds.dataset_version" :class="{'table-warning': ds.contract_status==='draft'}">
          <td><a href="#" @click.prevent="openDataset(ds.dataset_version)">{{ ds.dataset_version }}</a></td>
          <td>{{ ds.contract_id }}:{{ ds.contract_version }} <span class="badge bg-warning text-dark" v-if="ds.contract_status==='draft'">draft</span></td>
          <td>{{ ds.status }}</td>
          <td v-if="ds.contract_status==='draft'"><button class="btn btn-sm btn-outline-primary" @click="validateContract(ds.contract_id, ds.contract_version)">Validate</button></td>
        </tr>
      </tbody>
    </table>
  </div>

  <div v-if="view==='dataset-detail'">
    <button class="btn btn-link" @click="view='datasets'">&larr; Back</button>
    <h2>Dataset {{datasetDetail.record.dataset_version}}</h2>
    <p><strong>Contract:</strong> {{datasetDetail.record.contract_id}}:{{datasetDetail.record.contract_version}}</p>
    <p><strong>Status:</strong> {{datasetDetail.record.status}}</p>
    <div>
      <h3>Schema</h3>
      <ul>
        <li v-for="prop in datasetDetail.contract.schema[0].properties" :key="prop.name">{{ prop.name }}: {{ prop.physicalType }}</li>
      </ul>
    </div>
    <div>
      <h3>Data Quality</h3>
      <table class="table">
        <thead><tr><th>Rule</th><th>Predicate</th><th>Violations</th></tr></thead>
        <tbody>
          <tr v-for="(expr, name) in datasetDetail.expectations" :key="name">
            <td>{{ name }}</td>
            <td>{{ expr }}</td>
            <td>{{ datasetDetail.record.dq_details.metrics['violations.' + name] || 0 }}</td>
          </tr>
        </tbody>
      </table>
      <p>Row count: {{ datasetDetail.record.dq_details.metrics['row_count'] }}</p>
    </div>
  </div>

  <div v-if="view==='contracts'">
    <h2>Contracts</h2>
    <table class="table">
      <thead><tr><th>Contract</th><th>Status</th></tr></thead>
      <tbody>
        <tr v-for="c in contracts" :key="c.id + c.version">
          <td><a href="#" @click.prevent="openContract(c.id, c.version)">{{c.id}}:{{c.version}}</a></td>
          <td>{{ c.status }}</td>
        </tr>
      </tbody>
    </table>
  </div>

  <div v-if="view==='contract-detail'">
    <button class="btn btn-link" @click="view='contracts'">&larr; Back</button>
    <h2>Contract {{contractDetail.contract.id}}:{{contractDetail.contract.version}}</h2>
    <p><strong>Status:</strong> {{contractDetail.status}}</p>
    <div>
      <h3>Schema</h3>
      <ul>
        <li v-for="prop in contractDetail.contract.schema[0].properties" :key="prop.name">{{prop.name}}: {{prop.physicalType}}</li>
      </ul>
    </div>
    <div>
      <h3>Data Quality Rules</h3>
      <ul>
        <li v-for="(expr, name) in contractDetail.expectations" :key="name">{{name}}: {{expr}}</li>
      </ul>
    </div>
    <div>
      <h3>Dataset history</h3>
      <ul>
        <li v-for="r in contractDetail.datasets" :key="r.dataset_version">
          {{r.dataset_version}} - {{r.status}}
        </li>
      </ul>
    </div>
  </div>
</div>
<script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
<script src="/static/app.js"></script>
</body>
</html>
