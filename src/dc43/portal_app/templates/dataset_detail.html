{% extends "base.html" %}
{% block content %}
<h1>{{ record.dataset_id }} {{ record.dataset_version }}</h1>
<p><a href="/datasets/{{ record.dataset_id }}">Back to versions</a></p>
<p>
  Status:
  <span class="badge {{ status.badge }}">{{ status.label }}</span>
  {% if linked_contract %}
    <span class="ms-3 text-muted">Linked contract {{ linked_contract }}</span>
  {% endif %}
</p>
<h2>Events</h2>
{% if record.events %}
  <div class="list-group mb-3">
  {% for event in record.events %}
    <div class="list-group-item">
      <div class="d-flex justify-content-between">
        <div>
          <div class="fw-semibold">{{ event.operation or 'unknown' }}</div>
          {% if event.dq_status %}
            <span class="badge {{ event.status_info.badge }} text-uppercase">{{ event.status_info.label }}</span>
          {% endif %}
        </div>
        <div class="text-muted small">{{ event.recorded_at or 'unknown time' }}</div>
      </div>
      {% if event.pipeline_context %}
        <pre class="small bg-light p-2 mt-2">{{ event.pipeline_context | tojson(indent=2) }}</pre>
      {% endif %}
      {% if event.dq_details %}
        <pre class="small bg-light p-2 mt-2">{{ event.dq_details | tojson(indent=2) }}</pre>
      {% endif %}
    </div>
  {% endfor %}
  </div>
{% else %}
  <p class="text-muted">No events recorded.</p>
{% endif %}
{% endblock %}
